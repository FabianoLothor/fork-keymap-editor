{"version":3,"file":"182.dac1023d7af71a777082.js","mappings":"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","sources":["webpack:///./src/Dialogs/LayoutGenerationError.js","webpack:///./src/Sources/Local/LocalActions.js","webpack:///./src/Sources/Local/Picker.js"],"sourcesContent":["import PropTypes from 'prop-types'\n\nimport DialogBox from '../Common/DialogBox'\nimport Modal from '../Common/Modal'\nimport { GitHubIssuesLink } from './support'\n\nfunction LayoutGenerationError (props) {\n  const { onDismiss } = props\n\n  return (\n    <Modal>\n      <DialogBox onDismiss={onDismiss}>\n        <h2>Automatic Layout Generation Failed</h2>\n        <p>\n          No accompanying layout was found with your keymap file and the Keymap\n          Editor was unable to generate one automatically for you.\n        </p>\n        <p>\n          Something went wrong with the attempted automatic layout generation\n          for your keyboard and there's no automatic way to recover, but if you\n          want to reach out for assistance maybe we can work together to resolve\n          any technical issues or else craft a manual layout for your keyboard.\n        </p>\n        <p>\n          Share your experience at {GitHubIssuesLink}.\n        </p>\n      </DialogBox>\n    </Modal>\n  )\n}\n\nLayoutGenerationError.propTypes = {\n  onDismiss: PropTypes.func.isRequired\n}\n\nexport default LayoutGenerationError\n","import { useDispatch, useSelector } from 'react-redux'\n\nimport * as api from './api'\nimport ActionButton from '../../Common/ActionButton'\n\nconst stateSelector = state => state\n\nexport default function LocalActions () {\n  const dispatch = useDispatch()\n  const state = useSelector(stateSelector)\n  const {\n    sourceOther,\n    keyboard,\n    _unmodifiedKeymap\n  } = state\n\n  const hasChanged = keyboard && !Object.is(keyboard.keymap, _unmodifiedKeymap)\n\n  async function handleCompile () {\n    const keyboard = sourceOther.keyboard\n    const { keymap } = state.keyboard\n\n    try {\n      const updated = await api.updateKeymap(keyboard, keymap)\n      dispatch({\n        type: 'KEYMAP_SAVE_SUCCESS',\n        keymap: updated\n      })\n    } catch {\n      dispatch({ type: 'KEYMAP_SAVE_FAILURE' })\n    }\n  }\n\n  return (\n    <ActionButton disabled={!hasChanged} onClick={handleCompile}>\n      Save Changes\n    </ActionButton>\n  )\n}\n","import find from 'lodash/find'\nimport { useCallback, useEffect, useMemo, useState } from 'react'\n\nimport * as api from './api'\nimport LayoutGenerationError from '../../Dialogs/LayoutGenerationError'\nimport { Select } from '../Controls'\nimport LocalActions from './LocalActions'\n\nfunction LocalPicker ({ onSelect, onError }) {\n  const [keyboards, setKeyboards] = useState([])\n  const [keyboard, setKeyboard] = useState(null)\n\n  const choices = useMemo(() => (\n    keyboards.map(name => ({ id: name, name }))\n  ), [keyboards])\n\n  useEffect(() => {\n    (async function () {\n      const keyboards = await api.loadAvailableKeyboards()\n      const persistedKeyboard = JSON.parse(localStorage.getItem('localSourceSelectedKeyboard') || 'null')\n      const initialSelection = keyboards.includes(persistedKeyboard)\n        ? persistedKeyboard\n        : keyboards[0]\n\n      setKeyboards(keyboards)\n      setKeyboard(initialSelection)\n    })()\n  }, [setKeyboards, setKeyboard])\n\n  useEffect(() => {\n    (async function () {\n      if (keyboard) {\n        try {\n          const { info, keymap, sensors } = await api.loadKeyboardFiles(keyboard)\n          const { layouts } = info\n          const preferredLayout = keymap.chosen['zmk,matrix_transform']\n            ? keymap.chosen['zmk,matrix_transform'].replace(/^&/, '')\n            : null\n\n          const defaultLayout = Object.keys(layouts)[0]\n          const layoutMetadata = (\n            layouts[preferredLayout] ||\n            layouts[defaultLayout]\n          )\n\n          onSelect({\n            source: 'local',\n            keyboard,\n            layoutMetadata,\n            layout: layoutMetadata.layout,\n            keymap,\n            sensors\n          })\n        } catch (err) {\n          if (err.response) {\n            const error = await err.response.json()\n            if (error.name === 'LayoutGenerationError') {\n              onError({ dialog: LayoutGenerationError })\n              return\n            }\n          }\n\n          throw err\n        }\n      }\n    })()\n  }, [onSelect, onError, keyboard])\n\n  const handleSelectKeyboard = useCallback(({ id: keyboard }) => {\n    localStorage.setItem('localSourceSelectedKeyboard', JSON.stringify(keyboard))\n    setKeyboard(keyboard)\n  }, [setKeyboard])\n\n  const selection = find(choices, { id: keyboard })\n\n  return (\n    <>\n      <Select\n        label=\"Keyboard\"\n        value={selection}\n        options={choices}\n        onChange={handleSelectKeyboard}\n        getOptionValue={option => option.id}\n        getOptionLabel={option => option.name}\n      />\n      <LocalActions />\n    </>\n  )\n}\n\nexport default LocalPicker\n"],"names":["LayoutGenerationError","props","onDismiss","GitHubIssuesLink","propTypes","PropTypes","stateSelector","state","LocalActions","dispatch","useDispatch","useSelector","sourceOther","keyboard","_unmodifiedKeymap","hasChanged","Object","is","keymap","api","updated","type","ActionButton","disabled","onClick","i","onSelect","onError","useState","keyboards","setKeyboards","setKeyboard","choices","useMemo","map","name","id","useEffect","persistedKeyboard","JSON","parse","localStorage","getItem","initialSelection","includes","info","sensors","layouts","preferredLayout","chosen","replace","defaultLayout","keys","layoutMetadata","source","layout","response","json","dialog","handleSelectKeyboard","useCallback","setItem","stringify","selection","find","label","value","options","onChange","getOptionValue","option","getOptionLabel"],"sourceRoot":""}